import{isNumber,cloneDeep,take}from"lodash";import{ref,defineComponent,onActivated,h}from"vue";import{onBeforeRouteLeave}from"vue-router";let routeRelations=[];function setRalations(o){if(0==routeRelations.length){let e=o.getRoutes();routeRelations=e.map(e=>({deepth:e.meta.deepth,routeName:e.name}))}}function getRouteRelationDeepth(o){var e=routeRelations.find(e=>e.routeName===o);return void 0===e?99:e.deepth}function routeIndexInQueue(o){return routeQueue.value.findIndex(e=>e.name===o.name&&e.path===o.path)}function isRouteInQueue(e){return-1!==(isNumber(e)?e:routeIndexInQueue(e))}function pushToRouteQueue(e){!isRouteInQueue(e)&&e&&e.name&&routeQueue.value.push(e)}function onRouteChangeDetectKeepAlive(t,e){var u=routeIndexInQueue(t);routeIndexInQueue(e),isRouteInQueue(u)||(pushToRouteQueue(t),console.log("【1】",cloneDeep(routeQueue.value))),isRouteInQueue(u)&&(routeQueue.value=take(routeQueue.value,u+1),console.log("【2】",cloneDeep(routeQueue.value)));let n=getRouteRelationDeepth(t.name);var o=getRouteRelationDeepth(e.name),u=routeIndexInQueue(t),e=routeIndexInQueue(e);if(console.log("【3-1】",n,o,u,e),n<o&&-1!==e&&e<u){let e=take(routeQueue.value.map(e=>getRouteRelationDeepth(e.name)),u);console.log("【3-deepthArr】",e);let o=e.findIndex(e=>e<=n);-1===o&&(o=0),console.log("【3-replaceIndex",o),routeQueue.value[o]=t,console.log("【3-2】",cloneDeep(routeQueue.value)),routeQueue.value=take(routeQueue.value,o+1),console.log("【3-3】",cloneDeep(routeQueue.value))}}let routeQueue=ref([]);function onRouteChangeDetectTransition(e,o,t){var u=getRouteRelationDeepth(e.name),n=getRouteRelationDeepth(o.name);u===n&&99!==n?(e.meta.transition="fade",t?.onSameLevel?.(e,o)):n<=u?(e.meta.transition="slide-left",t?.onDeep?.(e,o)):(e.meta.transition="slide-right",t?.onShallow?.(e,o))}var scrollComponent=defineComponent({name:"scroll",setup(e,o){let t=ref(),u=ref(0);return onActivated(()=>{t.value&&(t.value.scrollTop=u.value)}),onBeforeRouteLeave(()=>{t.value&&(u.value=t.value.scrollTop)}),()=>h("div",{ref:t},o.slots.default())}});const Scroll={install(e,o){e.component(o?.name||scrollComponent.name,scrollComponent)}};function setKeepAliveAndTransition(e,o,t){onRouteChangeDetectKeepAlive(e,o),onRouteChangeDetectTransition(e,o,t)}export{Scroll,routeQueue,setKeepAliveAndTransition,setRalations};
